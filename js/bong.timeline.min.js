var Timeline=function(){var a,b,c,d,e,f,g,h,i=864e5,j={missingIdentifier:"Missing identifier",invalidDataModel:"The model does not have necessary attributes"},k={noData:"No data was provided",endStartDateMissMatch:"End date cannot be greater than start date. Data ignored.",endStartDateExchanged:"End date cannot be greater than start date. Dates exchanged.",missingMandatoryData:"Missing mandatory data. Date ignored. Following properties are mandatory: startDate, endDate & title",incorrectDateFormat:"Invalid date format. Data ignored."},l={orientation:"horizontal",range:20,slotSize:90,slotSpace_horizontal:45,slotSpace_vertical:125,slotExtend_vertical:75,slotExtend_horizontal:60,isSortedData:!1,clutter:!1,clutter_extras:7,template:function(a){return"<span class='block'>"+a.title+"</span>"},scrollToOffset:2,renderEmptyTimeline:!0},m={vertical:"vertical",today:"today",latest:"latest",next:"next",closest:"closest"},n={horizontal:{size:"width",space:"top",offset:"left",scrollDirection:"scrollLeft",scrollOffset:"offsetWidth"},vertical:{size:"height",space:"left",offset:"top",scrollDirection:"scrollTop",scrollOffset:"offsetHeight"}},o={horizontal:{timeline:"timeline",scroller:"scroller",content:"content",units:"units",unit:"unit",date:"date",event:"event",line:"line",day:"day",month:"month",year:"year",mark:"mark"},vertical:{timeline:"timeline vertical",scroller:"scroller",content:"content",units:"units",unit:"unit",date:"date",event:"event",line:"line",day:"day",month:"month",year:"year",mark:"mark"}},p={horizontal:{dateSeperator:"<br/>"},vertical:{dateSeperator:"<br/>"}},q=n.horizontal,r=o.horizontal,s=p.horizontal,t=[],u=[],v=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],w=document.createDocumentFragment(),x=function(b){if("string"!=typeof b.wrapperId)throw j.missingIdentifier;b.data instanceof Array||console.warn(k.noData),a=this,this.wrapperId=b.wrapperId,this.range="number"!=typeof b.range?l.range:b.range,this.defaultDate=b.defaultDate instanceof Date&&"Invalid Date"!=b.defaultDate?b.defaultDate:new Date,this.startDate=new Date(this.defaultDate.valueOf()-this.range*i),this.endDate=new Date(this.defaultDate.valueOf()+this.range*i),this.data=b.data instanceof Array?b.data:[],this.isSortedData="boolean"==typeof b.isSortedData?b.isSortedData:l.isSortedData,this.dataModel=b.dataModel,this.orientation="string"!=typeof b.orientation?l.orientation:b.orientation,this.slotSize="number"!=typeof b.slotSize?l.slotSize:b.slotSize,this.slotSpace="number"!=typeof b.slotSpace?this.orientation==m.vertical?l.slotSpace_vertical:l.slotSpace_horizontal:b.slotSpace,this.slotExtend=this.orientation==m.vertical?l.slotExtend_vertical:l.slotExtend_horizontal,this.template="function"==typeof b.template?b.template:l.template,this.onRender=b.onRender,this.clutter="boolean"==typeof b.clutter?b.clutter:l.clutter,this.clutterExtras="number"==typeof b.clutterExtras?b.clutterExtras:l.clutter_extras,this.renderEmptyTimeline="boolean"==typeof b.renderEmptyTimeline?b.renderEmptyTimeline:l.renderEmptyTimeline,this.onEmptyTimeline="function"==typeof b.onEmptyTimeline?b.onEmptyTimeline:void 0,this.render(),0==t.length&&this.onEmptyTimeline&&this.onEmptyTimeline()};x.prototype={setAttributes:function(a){return this.defaultDate=a.defaultDate instanceof Date?a.defaultDate:this.defaultDate?this.defaultDate:new Date,this.data=a.data instanceof Array?a.data:this.data?this.data:[],this.startDate=new Date(this.defaultDate.valueOf()-this.range*i),this.endDate=new Date(this.defaultDate.valueOf()+this.range*i),this},render:function(){document.getElementById(this.wrapperId).innerHTML="",u=[],t=[],this.strip_time(),this.orientation==m.vertical&&y(),this.dataModel&&this.create_data(),this.isSortedData||this.sort_data(),this.dom_create_events(),(0!=t.length||this.renderEmptyTimeline)&&(this.dom_render(),t.length>0&&this.dom_draw_events(),this.clutter&&t.length>0||this.dom_assign_ui_events(),setTimeout(function(){d[q.scrollDirection]=d[q.scrollDirection]+g,a.onRender&&a.onRender()},0))},create_data:function(){if(!this.dataModel.startDate||!this.dataModel.endDate||!this.dataModel.title)throw j.invalidDataModel;for(var a,b=this.data.splice(0),c=[],d=0,e=b.length;d<e;d++)a={startDate:b[d][this.dataModel.startDate],endDate:b[d][this.dataModel.endDate],title:b[d][this.dataModel.title]},c.push(a);this.data=c},strip_time:function(){for(var a=0,b=this.data.length;a<b;a++)this.data[a].startDate.setHours(0),this.data[a].startDate.setMinutes(0),this.data[a].startDate.setSeconds(0),this.data[a].startDate.setMilliseconds(0)},sort_data:function(){this.data.sort(function(a,b){return new Date(a.startDate).valueOf()-new Date(b.startDate).valueOf()})},dom_render:function(){var a=document.createDocumentFragment();b=document.getElementById(this.wrapperId),c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("ul"),c.setAttribute("class",r.timeline),d.setAttribute("class",r.scroller),e.setAttribute("class",r.content),f.setAttribute("class",r.units),f.appendChild(this.clutter&&t.length>0?this.dom_get_units_fragment_clutter():this.dom_get_units_fragment(this.startDate,this.endDate)),d.appendChild(e),d.appendChild(f),c.appendChild(d),a.appendChild(c),b.appendChild(a)},dom_create_events:function(){for(var a,b,c,d,e,f,g,j=0,l=this.data,m=0,n=l.length;m<n;m++)"undefined"!=typeof l[m].startDate&&"undefined"!=typeof l[m].endDate&&"undefined"!=typeof l[m].title?!l[m].startDate instanceof Date||!l[m].startDate instanceof Date||"Invalid Date"==l[m].startDate||"Invalid Date"==l[m].endDate?console.warn(k.incorrectDateFormat):l[m].endDate<l[m].startDate?console.warn(k.endStartDateMissMatch):(a=document.createElement("div"),a.setAttribute("class",r.event),b=parseInt((l[m].endDate-l[m].startDate)/i)*this.slotSize+this.slotExtend,c=this.clutter?c?l[m].startDate.valueOf()-g.data.endDate.valueOf()>i?g.offset+g.size+this.slotSize-this.slotExtend:t[m-1].offset+parseInt((l[m].startDate-l[m-1].startDate)/i)*this.slotSize:this.clutterExtras*this.slotSize:parseInt((l[m].startDate-this.startDate)/i)*this.slotSize,e=z(c/this.slotSize,(0==b?1:b)/this.slotSize),j=e>j?e:j,d=e*this.slotSpace,f={size:b,offset:c,space:d,slotIndex:e,data:l[m]},t.push(f),this.clutter&&(g=g?f.data.endDate>g.data.endDate?f:g:f)):console.warn(k.missingMandatoryData);h=j},dom_draw_events:function(){for(var a,b=this.startDate,c=1/0,d=0,h=t.length;d<h;d++)a=document.createElement("div"),a.setAttribute("class",r.event),a.setAttribute("style",q.size+":"+t[d].size+"px;"+q.offset+":"+t[d].offset+"px;"+q.space+":"+t[d].space+"px;"),a.innerHTML=this.template(t[d].data),w.appendChild(a),t[d].dom=a,this.clutter&&Math.abs(this.defaultDate-t[d].data.startDate)<c&&(g=t[d].offset,c=this.defaultDate-t[d].data.startDate);e.setAttribute("style",q.size+":"+f.childNodes.length*this.slotSize+"px"),setTimeout(function(){e.innerHTML="",e.appendChild(w)},0),g=this.clutter?g-2*this.slotSize:((this.defaultDate-b)/i-l.scrollToOffset)*this.slotSize},dom_assign_ui_events:function(){var a=this;d.onscroll=function(){0==this[q.scrollDirection]&&a.dom_update_events_past(),this[q.scrollDirection]+d[q.scrollOffset]>=f.childElementCount*a.slotSize&&a.dom_update_events_future()}},dom_update_events_past:function(){var a=new Date(this.startDate.valueOf()-this.range*i),b=this.dom_get_units_fragment(a,this.startDate),c=(this.startDate-a)/i*this.slotSize;f.insertBefore(b,f.childNodes[0]);for(var g=0;g<t.length;g++)t[g].offset+=c,t[g].dom.style[q.offset]=t[g].offset+"px";this.startDate=a,e.setAttribute("style",q.size+":"+f.childNodes.length*this.slotSize+"px"),setTimeout(function(){d[q.scrollDirection]=c},0)},dom_update_events_future:function(){var a=new Date(this.endDate.valueOf()+this.range*i),b=this.dom_get_units_fragment(this.endDate,a);(a-this.endDate)/i*this.slotSize;f.appendChild(b),this.endDate=a,e.setAttribute("style",q.size+":"+f.childNodes.length*this.slotSize+"px")},dom_remove_elements:function(a){var b=document.getElementsByClassName(r.unit);if("top"==a)for(var c=0,d=b.length;c<d;c++)b[c].remove();else for(var c=b.length-1,d=-1;c>d;c--)b[c].remove()},dom_get_units_fragment:function(a,b){for(var c,d,e=document.createDocumentFragment(),f=parseInt((b-a)/i),g=0;g<f;g++)d=new Date(a.valueOf()+g*i),c=this.dom_get_unit(d),e.appendChild(c);return e},dom_get_units_fragment_clutter:function(){console.log(this.data);for(var a,b,c,d,e,f=document.createDocumentFragment(),g=!1,h=!0,j=this.clutterExtras;j>0;j--)f.appendChild(this.dom_get_unit(new Date(t[0].data.startDate.valueOf()-j*i)));for(var k=0,l=t.length;k<l;k++)if(b=h?t[k].data.startDate:b,c=k>0?t[k].data.endDate>c?t[k].data.endDate:c:t[k].data.endDate,h=t.length==k+1||t[k+1].data.startDate.valueOf()-c.valueOf()>i,a=parseInt((c-b)/i),h)for(var j=0;j<=a;j++)e=new Date(b.valueOf()+j*i),g=0==j||j==a,d=this.dom_get_unit(e,g,g,g),f.appendChild(d);for(var j=1;j<=this.clutterExtras;j++)f.appendChild(this.dom_get_unit(new Date(c.valueOf()+j*i),g,g,g)),g=!g&&g;return f},dom_get_unit:function(a,b,c,d){var e,f,g,h,j,k,l=new Date(a.valueOf()-i),m=new Date(a.valueOf()+i),n=a.getMonth()!=l.getMonth()||a.getMonth()!=m.getMonth()||b?v[a.getMonth()]:"",o=a.getYear()!=l.getYear()||a.getYear()!=m.getYear()||c||n?1900+a.getYear():"";return e=document.createElement("li"),e.setAttribute("class",r.unit),f=document.createElement("span"),f.setAttribute("class",r.date),h=document.createElement("div"),h.setAttribute("class",r.month),h.innerHTML=n,j=document.createElement("div"),j.setAttribute("class",r.day),j.innerHTML=a.getDate(),k=document.createElement("div"),k.setAttribute("class",r.year),k.innerHTML=o,f.appendChild(h),f.appendChild(j),f.appendChild(k),g=document.createElement("div"),g.setAttribute("class",r.line+" "+(d?r.mark:"")),e.appendChild(f),e.appendChild(g),e},getMaxSlotIndex:function(){return h},getDOMContent:function(){return e},getDOMScroller:function(){return d},getDOMUnits:function(){return f}};var y=function(){q=n.vertical,r=o.vertical,s=p.vertical},z=function(a,b){var c,d;if(0!=t.length){for(var e=0,f=u.length;e<f;e++){d=!0;for(var g=a,h=a+b;g<h;g++)if(1==u[e][g]){d=!1;break}if(d)break}e==u.length&&(u[e]=[]),c=e}else c=0;u[c]=[];for(var e=a;e<a+b;e++)u[c][e]=!0;return u[c][a]=!0,u[c][a+b-2]=!0,c};return x}();